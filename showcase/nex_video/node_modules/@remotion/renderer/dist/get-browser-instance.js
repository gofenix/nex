"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getPageAndCleanupFn = void 0;
const browser_1 = require("./browser");
const open_browser_1 = require("./open-browser");
const getPageAndCleanupFn = async ({ passedInInstance, browserExecutable, chromiumOptions, context, forceDeviceScaleFactor, indent, logLevel, }) => {
    if (passedInInstance) {
        const page = await passedInInstance.newPage(context, logLevel, indent);
        return {
            page,
            cleanup: () => {
                // Close puppeteer page and don't wait for it to finish.
                // Keep browser open.
                page.close().catch((err) => {
                    console.error('Was not able to close puppeteer page', err);
                });
            },
        };
    }
    const browserInstance = await (0, open_browser_1.internalOpenBrowser)({
        browser: browser_1.DEFAULT_BROWSER,
        browserExecutable,
        chromiumOptions,
        forceDeviceScaleFactor,
        indent,
        viewport: null,
        logLevel,
    });
    const browserPage = await browserInstance.newPage(context, logLevel, indent);
    return {
        page: browserPage,
        cleanup: () => {
            // Close whole browser that was just created and don't wait for it to finish.
            browserInstance.close(true, logLevel, indent).catch((err) => {
                console.error('Was not able to close puppeteer page', err);
            });
        },
    };
};
exports.getPageAndCleanupFn = getPageAndCleanupFn;
