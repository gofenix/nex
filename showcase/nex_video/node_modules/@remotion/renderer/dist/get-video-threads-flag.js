"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getIdealVideoThreadsFlag = void 0;
const node_os_1 = __importDefault(require("node:os"));
const MEMORY_USAGE_PER_THREAD = 400000000; // 400MB
const RESERVED_MEMORY = 2000000000;
const getIdealVideoThreadsFlag = () => {
    const freeMemory = node_os_1.default.freemem();
    const cpus = node_os_1.default.cpus().length;
    const maxRecommendedBasedOnCpus = (cpus * 2) / 3;
    const maxRecommendedBasedOnMemory = (freeMemory - RESERVED_MEMORY) / MEMORY_USAGE_PER_THREAD;
    const maxRecommended = Math.min(maxRecommendedBasedOnCpus, maxRecommendedBasedOnMemory);
    return Math.max(1, Math.round(maxRecommended));
};
exports.getIdealVideoThreadsFlag = getIdealVideoThreadsFlag;
