"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getActualConcurrency = void 0;
const node_os_1 = __importDefault(require("node:os"));
const getActualConcurrency = (userPreference) => {
    if (userPreference === null) {
        return Math.round(Math.min(8, Math.max(1, node_os_1.default.cpus().length / 2)));
    }
    const max = node_os_1.default.cpus().length;
    const min = 1;
    let rounded;
    if (typeof userPreference === 'string') {
        const percentage = parseInt(userPreference.slice(0, -1), 10);
        rounded = Math.floor((percentage / 100) * max);
    }
    else {
        rounded = Math.floor(userPreference);
    }
    if (rounded > max) {
        throw new Error(`Maximum for --concurrency is ${max} (number of cores on this system)`);
    }
    if (rounded < min) {
        throw new Error(`Minimum for concurrency is ${min}.`);
    }
    return rounded;
};
exports.getActualConcurrency = getActualConcurrency;
